C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AS608
OBJECT MODULE PLACED IN .\Objects\AS608.obj
COMPILER INVOKED BY: D:\Program Files\Keil_v5_C51\C51\BIN\C51.EXE Users\AS608.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Users)
                    - DEBUG OBJECTEXTEND PRINT(.\Listings\AS608.lst) TABS(2) OBJECT(.\Objects\AS608.obj)

line level    source

   1          /********************************************************************************
   2           * ÎÄ ¼þ Ãû: AS608.c
   3           * °æ ±¾ ºÅ: ³õ°æ
   4           * ÐÞ¸Ä×÷Õß: Smoaflie
   5           * ÐÞ¸ÄÈÕÆÚ: 2023Äê08ÔÂ27ÈÕ
   6           * ¹¦ÄÜ½éÉÜ: 51µ¥Æ¬»ú-Í¨¹ýUARTÓëAS608Ä£¿é½øÐÐÍ¨Ñ¶         
   7           ******************************************************************************
   8           * ×¢ÒâÊÂÏî:  ¸Ã´úÂë×ñÊØ GPL3.0¿ªÔ´Ð­Òé£¬½ö¹©Ñ§Ï°²Î¿¼£¬½ûÖ¹ÉÌÓÃ
   9           *********************************************************************************/
  10          
  11          #include "AS608.h"
  12          
  13          /************************************************
  14            º¯ÊýÃû³Æ  :   AS608_SendHead
  15            ¹¦    ÄÜ  :   ·¢ËÍ°üµÄÇ°¶Î²¿·Ö(°üÍ·¡¢µØÖ·¡¢±êÊ¶¡¢³¤¶È£©
  16            ²Î    Êý  :   flag£º°ü±êÊ¶
  17            length£º°ü³¤¶È
  18            cmd£ºÖ¸ÁîÂë
  19            ·µ »Ø Öµ  :   ÎÞ
  20           *************************************************/
  21          void AS608_SendHead(u8 flag,u16 length)
  22          {
  23   1        /* ·¢ËÍ°üÍ· */
  24   1        UART_SendByte(0xEF);
  25   1        UART_SendByte(0x01);
  26   1        /* ·¢ËÍµØÖ· */
  27   1        UART_SendByte(AS608Addr>>24);
  28   1        UART_SendByte(AS608Addr>>16);
  29   1        UART_SendByte(AS608Addr>>8);
  30   1        UART_SendByte(AS608Addr);
  31   1        /* ·¢ËÍ°ü±êÊ¶ */
  32   1        UART_SendByte(flag);
  33   1        /* ·¢ËÍ°ü³¤¶È */
  34   1        UART_SendByte(length>>8);
  35   1        UART_SendByte(length);
  36   1      }
  37          
  38          /************************************************
  39            º¯ÊýÃû³Æ  :   AS608_SendCmdPkg
  40            ¹¦    ÄÜ  :   ·¢ËÍ²»´ø²ÎÊýµÄÃüÁî°ü
  41            ²Î    Êý  :   flag£º°ü±êÊ¶
  42            length£º°ü³¤¶È
  43            cmd£ºÖ¸ÁîÂë
  44            ·µ »Ø Öµ  :   ÎÞ
  45           *************************************************/
  46          //·¢ËÍ²»´ø²ÎÊýµÄÃüÁî°ü
  47          void AS608_SendCmdPkg(u8 flag,u16 length,u8 cmd)
  48          {
  49   1        u16 AS608_Bytes_Sum = (u16)flag+(u16)length+(u16)cmd;     //ÓÃÒÔ´æ´¢°ü±êÊ¶ÖÁÐ£ÑéºÍÖ®¼äËùÓÐ×Ö½ÚÖ®ºÍ(²»°üÀ¨Ð£
             -ÑéºÍ)
  50   1        AS608_SendHead(flag,length);  //·¢ËÍ°üµÄÇ°¶Î²¿·Ö
  51   1        /* ·¢ËÍÖ¸ÁîÂë */
  52   1        UART_SendByte(cmd);
  53   1        /* ·¢ËÍÐ£ÑéºÍ */
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 2   

  54   1        UART_SendByte(AS608_Bytes_Sum>>8);
  55   1        UART_SendByte(AS608_Bytes_Sum);
  56   1      }
  57          
  58          /************************************************
  59            º¯ÊýÃû³Æ  :   AS608_SendParamPkg
  60            ¹¦    ÄÜ  :   ·¢ËÍ´ø²ÎÊýµÄÃüÁî°ü
  61            ²Î    Êý  :   flag£º°ü±êÊ¶
  62            length£º°ü³¤¶È
  63            cmd£ºÖ¸ÁîÂë
  64            data£º²ÎÊý
  65            ·µ »Ø Öµ  :   ÎÞ
  66           *************************************************/
  67          void AS608_SendParamPkg(u8 flag,u16 length,u8 cmd,u8 *ucstr)
  68          {
  69   1        u16 AS608_Bytes_Sum = (u16)flag+(u16)length+(u16)cmd;     //ÓÃÒÔ´æ´¢°ü±êÊ¶ÖÁÐ£ÑéºÍÖ®¼äËùÓÐ×Ö½ÚÖ®ºÍ(²»°üÀ¨Ð£
             -ÑéºÍ)
  70   1        AS608_SendHead(flag,length);  //·¢ËÍ°üµÄÇ°¶Î²¿·Ö
  71   1        /* ·¢ËÍÖ¸ÁîÂë */
  72   1        UART_SendByte(cmd);
  73   1        /* ·¢ËÍÊý¾Ý/²ÎÊý */
  74   1        length-=3;        //¼õÈ¥ Ö¸ÁîÂë&Ð£ÑéºÍ µÄ×Ö½ÚÊý£¬µÃµ½ ²ÎÊý µÄ³¤¶È
  75   1        while(length--)
  76   1        {
  77   2          AS608_Bytes_Sum += *ucstr;
  78   2          UART_SendByte(*ucstr++);
  79   2        }
  80   1        /* ·¢ËÍÐ£ÑéºÍ */
  81   1        UART_SendByte(AS608_Bytes_Sum>>8);
  82   1        UART_SendByte(AS608_Bytes_Sum);
  83   1      }
  84          
  85          /************************************************
  86            º¯ÊýÃû³Æ  :   AS608_SendDataPkg
  87            ¹¦    ÄÜ  :   ·¢ËÍÊý¾Ý°ü
  88            ²Î    Êý  :   ÎÞ
  89            ·µ »Ø Öµ  :   ÎÞ
  90           *************************************************/
  91          void AS608_SendDataPkg(u8 flag,u16 length,u8 cmd,u8 *ucstr)
  92          {
  93   1        u16 AS608_Bytes_Sum = (u16)flag+(u16)length;      //ÓÃÒÔ´æ´¢°ü±êÊ¶ÖÁÐ£ÑéºÍÖ®¼äËùÓÐ×Ö½ÚÖ®ºÍ(²»°üÀ¨Ð£ÑéºÍ)
  94   1        AS608_SendHead(flag,length);  //·¢ËÍ°üµÄÇ°¶Î²¿·Ö
  95   1        /* ·¢ËÍÖ¸ÁîÂë */
  96   1        UART_SendByte(cmd);
  97   1        /* ·¢ËÍÊý¾Ý/²ÎÊý */
  98   1        length-=2;        //¼õÈ¥ Ð£ÑéºÍ µÄ×Ö½ÚÊý£¬µÃµ½ Êý¾Ý µÄ³¤¶È
  99   1        while(length--)
 100   1        {
 101   2          AS608_Bytes_Sum += *ucstr;
 102   2          UART_SendByte(*ucstr++);
 103   2        }
 104   1        /* ·¢ËÍÐ£ÑéºÍ */
 105   1        UART_SendByte(AS608_Bytes_Sum>>8);
 106   1        UART_SendByte(AS608_Bytes_Sum);
 107   1      }
 108          /************************************************
 109            º¯ÊýÃû³Æ  :   PS_GetImage
 110            ¹¦    ÄÜ  :   Ì½²âÊÖÖ¸£¬Ì½²âµ½ºóÂ¼ÈëÖ¸ÎÆÍ¼Ïñ´æÓÚ ImageBuffer¡£
 111            ²Î    Êý  :   ÎÞ
 112            ·µ »Ø Öµ  :   ÎÞ
 113           *************************************************/
 114          void PS_GetImage(void)
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 3   

 115          {
 116   1        AS608_SendCmdPkg(0x01,0x0003,0x01);
 117   1      }
 118          
 119          /************************************************
 120            º¯ÊýÃû³Æ  :   PS_GenChar
 121            ¹¦    ÄÜ  :   ½« ImageBuffer ÖÐµÄÔ­Ê¼Í¼ÏñÉú³ÉÖ¸ÎÆÌØÕ÷ÎÄ¼þ´æÓÚ CharBuffer1 »ò CharBuffer2 
 122            ²Î    Êý  :   BufferID(ÌØÕ÷»º³åÇøºÅ)
 123            È¡ Öµ :   »º³åÇø CharBuffer1¡¢CharBuffer2 µÄ BufferID ·Ö±ðÎª 1h ºÍ 2h£¬Èç¹ûÖ¸¶¨ÆäËûÖµ£¬°´ÕÕ CharBuffer2 ´
             -¦Àí
 124            ·µ »Ø Öµ  :   ÎÞ
 125           *************************************************/
 126          void PS_GenChar(u8 BufferID)
 127          {
 128   1        AS608_SendParamPkg(0x01,0x0004,0x02,&BufferID);
 129   1      }
 130          
 131          /************************************************
 132            º¯ÊýÃû³Æ  :   PS_Match
 133            ¹¦    ÄÜ  :   ¾«È·±È¶Ô CharBuffer1 Óë CharBuffer2 ÖÐµÄÌØÕ÷ÎÄ¼þ
 134            ²Î    Êý  :   ÎÞ
 135            ·µ »Ø Öµ  :   ÎÞ
 136           *************************************************/
 137          void PS_Match(void)
 138          {
 139   1        AS608_SendCmdPkg(0x01,0x0003,0x03);
 140   1      }
 141          
 142          /************************************************
 143            º¯ÊýÃû³Æ  :   PS_Search
 144            ¹¦    ÄÜ  :   ÒÔ CharBuffer1 »ò CharBuffer2 ÖÐµÄÌØÕ÷ÎÄ¼þËÑË÷Õû¸ö»ò²¿·ÖÖ¸ÎÆ¿â¡£ÈôËÑË÷µ½£¬Ôò·µ»ØÒ³Âë¡£
 145            ²Î    Êý  :   BufferID(ÌØÕ÷»º³åÇøºÅ)
 146            StartPage(ÆðÊ¼Ò³)
 147            PageNum£¨Ò³Êý£© 
 148            ·µ »Ø Öµ  :   ÎÞ
 149           *************************************************/
 150          void PS_Search(u8 BufferID,u16 StartPage,u16 PageNum)
 151          {
 152   1        u8  AS608_data_tmp[5];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 153   1        AS608_data_tmp[0]=BufferID;
 154   1        AS608_data_tmp[1]=StartPage>>8;
 155   1        AS608_data_tmp[2]=StartPage;
 156   1        AS608_data_tmp[3]=PageNum>>8;
 157   1        AS608_data_tmp[4]=PageNum;
 158   1        AS608_SendParamPkg(0x01,0x0008,0x04,AS608_data_tmp);
 159   1      }
 160          
 161          /************************************************
 162            º¯ÊýÃû³Æ  :   PS_RegModel
 163            ¹¦    ÄÜ  :   ½« CharBuffer1 Óë CharBuffer2 ÖÐµÄÌØÕ÷ÎÄ¼þºÏ²¢Éú³ÉÄ£°å£¬½á¹û´æÓÚ CharBuffer1 Óë CharBuffer2
             -¡£
 164            ²Î    Êý  :   ÎÞ
 165            ·µ »Ø Öµ  :   ÎÞ
 166           *************************************************/
 167          void PS_RegModel(void)
 168          {
 169   1        AS608_SendCmdPkg(0x01,0x0003,0x05);
 170   1      }
 171          
 172          /************************************************
 173            º¯ÊýÃû³Æ  :   PS_StoreChar
 174            ¹¦    ÄÜ  :   ½« CharBuffer1 »ò CharBuffer2 ÖÐµÄÄ£°åÎÄ¼þ´æµ½ PageID ºÅflash Êý¾Ý¿âÎ»ÖÃ¡£
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 4   

 175            ²Î    Êý  :   BufferID(»º³åÇøºÅ)
 176                          PageID£¨Ö¸ÎÆ¿âÎ»ÖÃºÅ£© 
 177            ·µ »Ø Öµ  :   ÎÞ
 178           *************************************************/
 179          void PS_StoreChar(u8 BufferID,u16 PageID)
 180          {
 181   1        u8  AS608_data_tmp[3];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 182   1        AS608_data_tmp[0]=BufferID;
 183   1        AS608_data_tmp[1]=PageID>>8;
 184   1        AS608_data_tmp[2]=PageID;
 185   1        AS608_SendParamPkg(0x01,0x0006,0x06,AS608_data_tmp);
 186   1      }
 187          
 188          /************************************************
 189            º¯ÊýÃû³Æ  :   PS_LoadChar
 190            ¹¦    ÄÜ  :   ½« flash Êý¾Ý¿âÖÐÖ¸¶¨ ID ºÅµÄÖ¸ÎÆÄ£°å¶ÁÈëµ½Ä£°å»º³åÇø CharBuffer1 »ò CharBuffer2
 191            ²Î    Êý  :   BufferID(»º³åÇøºÅ)
 192            PageID(Ö¸ÎÆ¿âÄ£°åºÅ)
 193            ·µ »Ø Öµ  :   ÎÞ
 194           *************************************************/
 195          void PS_LoadChar(u8 BufferID,u16 PageID)
 196          {
 197   1        u8  AS608_data_tmp[3];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 198   1        AS608_data_tmp[0]=BufferID;
 199   1        AS608_data_tmp[1]=PageID>>8;
 200   1        AS608_data_tmp[2]=PageID;
 201   1        AS608_SendParamPkg(0x01,0x0006,0x07,AS608_data_tmp);
 202   1      }
 203          
 204          /************************************************
 205            º¯ÊýÃû³Æ  :   PS_UpChar
 206            ¹¦    ÄÜ  :   ½«ÌØÕ÷»º³åÇøÖÐµÄÌØÕ÷ÎÄ¼þÉÏ´«¸øÉÏÎ»»ú
 207            ²Î    Êý  :   BufferID(»º³åÇøºÅ)
 208            ·µ »Ø Öµ  :   ÎÞ
 209           *************************************************/
 210          void PS_UpChar(u8 BufferID)
 211          {
 212   1        AS608_SendParamPkg(0x01,0x0004,0x08,&BufferID);
 213   1      }
 214          
 215          /************************************************
 216            º¯ÊýÃû³Æ  :   PS_DownChar
 217            ¹¦    ÄÜ  :   ÉÏÎ»»úÏÂÔØÌØÕ÷ÎÄ¼þµ½Ä£¿éµÄÒ»¸öÌØÕ÷»º³åÇø
 218            ²Î    Êý  :   BufferID(»º³åÇøºÅ)
 219            ·µ »Ø Öµ  :   ÎÞ
 220           *************************************************/
 221          void PS_DownChar(u8 BufferID)
 222          {
 223   1        AS608_SendParamPkg(0x01,0x0004,0x09,&BufferID);
 224   1      }
 225          
 226          /************************************************
 227            º¯ÊýÃû³Æ  :   PS_UpImage
 228            ¹¦    ÄÜ  :   ½«Í¼Ïñ»º³åÇøÖÐµÄÊý¾ÝÉÏ´«¸øÉÏÎ»»ú
 229            ²Î    Êý  :   ÎÞ
 230            ·µ »Ø Öµ  :   ÎÞ
 231           *************************************************/
 232          void PS_UpImage(void)
 233          {
 234   1        AS608_SendCmdPkg(0x01,0x0003,0x0a);
 235   1      }
 236          
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 5   

 237          /************************************************
 238            º¯ÊýÃû³Æ  :   PS_DownImage
 239            ¹¦    ÄÜ  :   ÉÏÎ»»úÏÂÔØÍ¼ÏñÊý¾Ý¸øÄ£¿é
 240            ²Î    Êý  :   ÎÞ
 241            ·µ »Ø Öµ  :   ÎÞ
 242           *************************************************/
 243          void PS_DownImage(void)
 244          {
 245   1        AS608_SendCmdPkg(0x01,0x0003,0x0b);
 246   1      }
 247          
 248          /************************************************
 249            º¯ÊýÃû³Æ  :   PS_DeletChar
 250            ¹¦    ÄÜ  :   É¾³ý flash Êý¾Ý¿âÖÐÖ¸¶¨ ID ºÅ¿ªÊ¼µÄ N ¸öÖ¸ÎÆÄ£°å
 251            ²Î    Êý  :   PageID(Ö¸ÎÆ¿âÄ£°åºÅ)
 252            N É¾³ýµÄÄ£°å¸öÊý
 253            ·µ »Ø Öµ  :   ÎÞ
 254           *************************************************/
 255          void PS_DeletChar(u16 PageID,u16 N)
 256          {
 257   1        u8  AS608_data_tmp[4];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 258   1        AS608_data_tmp[0]=PageID>>8;
 259   1        AS608_data_tmp[1]=PageID;
 260   1        AS608_data_tmp[2]=N>>8;
 261   1        AS608_data_tmp[3]=N;
 262   1        AS608_SendParamPkg(0x01,0x0007,0x0c,AS608_data_tmp);
 263   1      }
 264          
 265          /************************************************
 266            º¯ÊýÃû³Æ  :   PS_Empty
 267            ¹¦    ÄÜ  :   É¾³ý flash Êý¾Ý¿âÖÐËùÓÐÖ¸ÎÆÄ£°å
 268            ²Î    Êý  :   ÎÞ
 269            ·µ »Ø Öµ  :   ÎÞ
 270           *************************************************/
 271          void PS_Empty(void)
 272          {
 273   1        AS608_SendCmdPkg(0x01,0x0003,0x0d);
 274   1      }
 275          
 276          /************************************************
 277            º¯ÊýÃû³Æ  :   PS_WriteReg
 278            ¹¦    ÄÜ  :   Ð´Ä£¿é¼Ä´æÆ÷
 279            ²Î    Êý  :   ID(Ïê¼ûÏÂ·½ËµÃ÷)
 280            text(Ïê¼ûÏÂ·½ËµÃ÷)
 281            È¡ Öµ :   ID  ½éÉÜ            N
 282            4   ²¨ÌØÂÊ¿ØÖÆ¼Ä´æÆ÷  (9600 µÄ±¶Êý N)
 283            5   ±È¶Ô·§Öµ¼Ä´æÆ÷    (1£ºlevel1 2£ºlevel2 3£ºlevel3 4£ºlevel4 5£ºlevel5)
 284            6   °ü´óÐ¡¼Ä´æÆ÷      (0£º32bytes 1£º64bytes 2£º128bytes 3£º256bytes)
 285            ·µ »Ø Öµ  :   ÎÞ
 286           *************************************************/
 287          void PS_WriteReg(u8 ID,u8 N)
 288          {
 289   1        u8  AS608_data_tmp[2];      //ÓÃÒÔÔÝ´æ ²ÎÊý/Êý¾Ý
 290   1        AS608_data_tmp[0]=ID;
 291   1        AS608_data_tmp[1]=N;
 292   1        AS608_SendParamPkg(0x01,0x0005,0x0e,AS608_data_tmp);
 293   1      }
 294          
 295          /************************************************
 296            º¯ÊýÃû³Æ  :   PS_ReadSysPara
 297            ¹¦    ÄÜ  :   ¶ÁÈ¡Ä£¿éµÄ»ù±¾²ÎÊý£¨²¨ÌØÂÊ£¬°ü´óÐ¡µÈ£©¡£ 
 298            ²ÎÊý±íÇ° 16 ¸ö×Ö½Ú´æ·ÅÁËÄ£¿éµÄ»ù±¾Í¨Ñ¶ºÍÅäÖÃÐÅÏ¢£¬³ÆÎªÄ£¿éµÄ»ù±¾²ÎÊý
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 6   

 299            ²Î    Êý  :   ÎÞ
 300            ·µ »Ø Öµ  :   ÎÞ
 301           *************************************************/
 302          void PS_ReadSysPara(void)
 303          {
 304   1        AS608_SendCmdPkg(0x01,0x0003,0x0f);
 305   1      }
 306          
 307          /************************************************
 308            º¯ÊýÃû³Æ  :   PS_Enroll
 309            ¹¦    ÄÜ  :   ²É¼¯Ò»´ÎÖ¸ÎÆ×¢²áÄ£°å£¬ÔÚÖ¸ÎÆ¿âÖÐËÑË÷¿ÕÎ»²¢´æ´¢£¬·µ»Ø´æ´¢ID
 310            ²Î    Êý  :   ÎÞ
 311            ·µ »Ø Öµ  :   ÎÞ
 312           *************************************************/
 313          void PS_Enroll(void)
 314          {
 315   1        AS608_SendCmdPkg(0x01,0x0003,0x10);
 316   1      }
 317          
 318          /************************************************
 319            º¯ÊýÃû³Æ  :   PS_Identify
 320            ¹¦    ÄÜ  :   ×Ô¶¯²É¼¯Ö¸ÎÆ£¬ÔÚÖ¸ÎÆ¿âÖÐËÑË÷Ä¿±êÄ£°å²¢·µ»ØËÑË÷½á¹û¡£ 
 321            ²Î    Êý  :   ÎÞ
 322            ·µ »Ø Öµ  :   ÎÞ
 323           *************************************************/
 324          void PS_Identify(void)
 325          {
 326   1        AS608_SendCmdPkg(0x01,0x0003,0x11);
 327   1      }
 328          
 329          /************************************************
 330            º¯ÊýÃû³Æ  :   PS_SetPwd
 331            ¹¦    ÄÜ  :   ÉèÖÃÄ£¿éÎÕÊÖ¿ÚÁî
 332            ²Î    Êý  :   PassWord£ºÃÜÂë
 333            ·µ »Ø Öµ  :   ÎÞ
 334           *************************************************/
 335          void PS_SetPwd(u32 PassWord)
 336          {
 337   1        AS608_SendParamPkg(0x01,0x0007,0x12,&PassWord);
*** WARNING C182 IN LINE 337 OF Users\AS608.c: pointer to different objects
 338   1      }
 339          
 340          /************************************************
 341            º¯ÊýÃû³Æ  :   PS_VfyPwd
 342            ¹¦    ÄÜ  :   ÑéÖ¤Ä£¿éÎÕÊÖ¿ÚÁî 
 343            ²Î    Êý  :   PassWord
 344            ·µ »Ø Öµ  :   ÎÞ
 345           *************************************************/
 346          void PS_VfyPwd(u32 PassWord)
 347          {
 348   1        AS608_SendParamPkg(0x01,0x0007,0x13,&PassWord);
*** WARNING C182 IN LINE 348 OF Users\AS608.c: pointer to different objects
 349   1      }
 350          
 351          /************************************************
 352            º¯ÊýÃû³Æ  :   PS_GetRandomCode
 353            ¹¦    ÄÜ  :   ÁîÐ¾Æ¬Éú³ÉÒ»¸öËæ»úÊý²¢·µ»Ø¸øÉÏÎ»»ú
 354            ²Î    Êý  :   ÎÞ
 355            ·µ »Ø Öµ  :   ÎÞ
 356           *************************************************/
 357          void PS_GetRandomCode(void)
 358          {
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 7   

 359   1        AS608_SendCmdPkg(0x01,0x0003,0x14);
 360   1      }
 361          
 362          /************************************************
 363            º¯ÊýÃû³Æ  :   PS_SetChipAddr
 364            ¹¦    ÄÜ  :   ÉèÖÃÐ¾Æ¬µØÖ· 
 365            ²Î    Êý  :   Addr
 366            ·µ »Ø Öµ  :   ÎÞ
 367           *************************************************/
 368          void PS_SetChipAddr(u32 Addr)
 369          {
 370   1        AS608_SendParamPkg(0x01,0x0007,0x15,&Addr);
*** WARNING C182 IN LINE 370 OF Users\AS608.c: pointer to different objects
 371   1      }
 372          
 373          /************************************************
 374            º¯ÊýÃû³Æ  :   PS_ReadINFpage
 375            ¹¦    ÄÜ  :   ¶ÁÈ¡ FLASH Information Page ËùÔÚµÄÐÅÏ¢Ò³(512bytes)
 376            ²Î    Êý  :   ÎÞ
 377            ·µ »Ø Öµ  :   ÎÞ
 378           *************************************************/
 379          void PS_ReadINFpage(void)
 380          {
 381   1        AS608_SendCmdPkg(0x01,0x0003,0x16);
 382   1      }
 383          
 384          /************************************************
 385            º¯ÊýÃû³Æ  :   PS_Port_Control
 386            ¹¦    ÄÜ  :   ¶Ô USB Í¨Ñ¶¶Ë¿Ú½øÐÐ¿ª¹Ø¿ØÖÆ¡£
 387            ²Î    Êý  :   Cmd
 388            È¡ Öµ :   0 ¹Ø±Õ¶Ë¿Ú;1 ¿ªÆô¶Ë¿Ú
 389            ·µ »Ø Öµ  :   ÎÞ
 390           *************************************************/
 391          void PS_Port_Control(u8 Cmd)
 392          {
 393   1        AS608_SendParamPkg(0x01,0x0004,0x17,&Cmd);
 394   1      }
 395          
 396          /************************************************
 397            º¯ÊýÃû³Æ  :   PS_WriteNotepad
 398            ¹¦    ÄÜ  :   Ä£¿éÄÚ²¿ÎªÓÃ»§¿ª±ÙÁË 256bytes µÄ FLASH ¿Õ¼äÓÃÓÚ´æ·ÅÓÃ»§Êý¾Ý£¬¸Ã´æ´¢¿Õ¼ä³ÆÎªÓÃ»§¼ÇÊÂ±¾£¬¸Ã¼Ç
             -ÊÂ±¾Âß¼­ÉÏ±»·Ö³É 16 ¸öÒ³£¬Ð´¼ÇÊÂ±¾ÃüÁîÓÃÓÚÐ´ÈëÓÃ»§µÄ 32bytes Êý¾Ýµ½Ö¸¶¨µÄ¼ÇÊÂ±¾Ò³¡£
 399            ²Î    Êý  :   length(Ð´ÈëÐÅÏ¢´óÐ¡) 
 400            NotePageNum(Ò³Âë) 
 401            content(ÓÃ»§ÐÅÏ¢)
 402            ·µ »Ø Öµ  :   ÎÞ
 403           *************************************************/
 404          void PS_WriteNotepad(u8 NotePageNum,u8* content)
 405          {
 406   1        u8 length = 0x0024;
 407   1        u16 AS608_Bytes_Sum = (u16)0x01+(u16)0x0024+(u16)0x18+(u16)NotePageNum;     //ÓÃÒÔ´æ´¢°ü±êÊ¶ÖÁÐ£ÑéºÍÖ®¼äËùÓ
             -Ð×Ö½ÚÖ®ºÍ(²»°üÀ¨Ð£ÑéºÍ)
 408   1        AS608_SendHead(0x01,0x0024);  //·¢ËÍ°üµÄÇ°¶Î²¿·Ö
 409   1        /* ·¢ËÍÖ¸ÁîÂë */
 410   1        UART_SendByte(0x18);
 411   1        /* ·¢ËÍÒ³Âë(²ÎÊý) */
 412   1        UART_SendByte(NotePageNum);
 413   1        /* ·¢ËÍÓÃ»§ÐÅÏ¢ */
 414   1        length-=4;  //¼õÈ¥ Ö¸ÁîÂë&Ò³Âë&Ð£ÑéºÍ µÄ×Ö½ÚÊý£¬µÃµ½ ²ÎÊý µÄ³¤¶È
 415   1        while(length--)
 416   1        {
 417   2          AS608_Bytes_Sum += *content;
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 8   

 418   2          UART_SendByte(*content++);
 419   2        }
 420   1        /* ·¢ËÍÐ£ÑéºÍ */
 421   1        UART_SendByte(AS608_Bytes_Sum>>8);
 422   1        UART_SendByte(AS608_Bytes_Sum);
 423   1      }
 424          
 425          /************************************************
 426            º¯ÊýÃû³Æ  :   PS_ReadNotepad
 427            ¹¦    ÄÜ  :   ¶ÁÈ¡ FLASH ÓÃ»§ÇøµÄ 128bytes Êý¾Ý 
 428            ²Î    Êý  :   page(Òª¶ÁÈ¡µÄÒ³Âë)
 429            È¡ Öµ :   x (x=0~15)
 430            ·µ »Ø Öµ  :   ÎÞ
 431           *************************************************/
 432          void PS_ReadNotepad(u8 page)
 433          {
 434   1        AS608_SendParamPkg(0x01,0x0004,0x19,&page);
 435   1      }
 436          
 437          /************************************************
 438            º¯ÊýÃû³Æ  :   PS_BurnCode
 439            ¹¦    ÄÜ  :   ÉÏÎ»»úÏÂÔØ´úÂëÊý¾Ý²¢Ð´Èë FLASH
 440            ²Î    Êý  :   mode(Ä£Ê½)
 441            È¡ Öµ :   0:½ö½øÐÐÐÅÏ¢Ò³Éý¼¶;1:ÍêÕûÉý¼¶
 442            ·µ »Ø Öµ  :   ÎÞ
 443           *************************************************/
 444          void PS_BurnCode(u8 mode)
 445          {
 446   1        AS608_SendParamPkg(0x01,0x0004,0x1a,&mode);
 447   1      }
 448          
 449          /************************************************
 450            º¯ÊýÃû³Æ  :   PS_HighSpeedSearch
 451            ¹¦    ÄÜ  :   ÒÔ CharBuffer1 »ò CharBuffer2 ÖÐµÄÌØÕ÷ÎÄ¼þ¸ßËÙËÑË÷Õû¸ö»ò²¿·ÖÖ¸ÎÆ¿â¡£ÈôËÑË÷µ½£¬Ôò·µ»ØÒ³Âë¡£
 452            ²Î    Êý  :   BufferID(ÌØÕ÷»º³åÇøºÅ)
 453            StartPage(ÆðÊ¼Ò³)
 454            PageNum£¨Ò³Êý£©
 455            ·µ »Ø Öµ  :   ÎÞ
 456           *************************************************/
 457          void PS_HighSpeedSearch(u8 BufferID,u16 StartPage,u16 PageNum)
 458          {
 459   1        u8  AS608_data_tmp[5];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 460   1        AS608_data_tmp[0]=BufferID;
 461   1        AS608_data_tmp[1]=StartPage>>8;
 462   1        AS608_data_tmp[2]=StartPage;
 463   1        AS608_data_tmp[3]=PageNum>>8;
 464   1        AS608_data_tmp[4]=PageNum;
 465   1        AS608_SendParamPkg(0x01,0x0008,0x1b,AS608_data_tmp);
 466   1      }
 467          
 468          /************************************************
 469            º¯ÊýÃû³Æ  :   PS_GenBinImage
 470            ¹¦    ÄÜ  :   ¶ÔÍ¼Ïñ»º³åÇøÖÐµÄÖ¸ÎÆÍ¼Ïñ½øÐÐ´¦Àí²¢Éú³ÉÏ¸»¯Ö¸ÎÆÍ¼Ïñ
 471            ²Î    Êý  :   BinImgTpye
 472            È¡ Öµ :   0£º¶þÖµ»¯Í¼Ïñ 
 473            1£º²»º¬ÌØÕ÷µã±êÊ¶µÄÏ¸»¯Í¼Ïñ  
 474            2 »òÆäËû£º´øÓÐÌØÕ÷µã±êÊ¶µÄÏ¸»¯Í¼Ïñ
 475            ·µ »Ø Öµ  :   ÎÞ
 476           *************************************************/
 477          void PS_GenBinImage(u8 BinImgTpye)
 478          {
 479   1        AS608_SendParamPkg(0x01,0x0004,0x1c,&BinImgTpye);
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 9   

 480   1      }
 481          
 482          /************************************************
 483            º¯ÊýÃû³Æ  :   PS_ValidTempleteNum
 484            ¹¦    ÄÜ  :   ¶ÁÓÐÐ§Ä£°å¸öÊý
 485            ²Î    Êý  :   ÎÞ
 486            ·µ »Ø Öµ  :   ÎÞ
 487           *************************************************/
 488          void PS_ValidTempleteNum(void)
 489          {
 490   1        AS608_SendCmdPkg(0x01,0x0003,0x1d);
 491   1      }
 492          
 493          /************************************************
 494            º¯ÊýÃû³Æ  :   PS_UserGPIOCommand
 495            ¹¦    ÄÜ  :   ÓÃÓÚÊµÏÖÓÃ»§ GPIO Êä³ö¿ØÖÆÃüÁî£¨±£Áô£©
 496            ²Î    Êý  :   GPIOCx£º²»Í¬ Sensor ¿É¿ØÖÆµÄ GPIOC ²»Í¬£¬Çë¸ù¾Ý²Î¿¼Éè¼ÆÔ­ÀíÍ¼ÉèÖÃ£» 
 497            Status£º0£¬±íÊ¾Êä³öµÍµÍµçÆ½£»1£¬±íÊ¾Êä³ö¸ßµçÆ½£»
 498            ·µ »Ø Öµ  :   ÎÞ
 499           *************************************************/
 500          void PS_UserGPIOCommand(u8 GPIOCx,u8 Status)
 501          {
 502   1        u8  AS608_data_tmp[5];      //ÓÃÒÔÔÝ´æ ²ÎÊý
 503   1        AS608_data_tmp[0]=GPIOCx;
 504   1        AS608_data_tmp[1]=Status;
 505   1        AS608_SendParamPkg(0x01,0x0005,0x1e,AS608_data_tmp);
 506   1      }
 507          
 508          /************************************************
 509            º¯ÊýÃû³Æ  :   PS_ReadIndexTable
 510            ¹¦    ÄÜ  :   ¶ÁÈ¡Â¼ÈëÄ£°æµÄË÷Òý±í¡£ £¨±£Áô£©
 511            ²Î    Êý  :   PageID:Ë÷Òý±íÒ³Âë, Ò³Âë 0,1,2,3 ·Ö±ð¶ÔÓ¦Ä£°æ´Ó 0-256£¬256-512£¬
 512            512-768£¬768-1024 µÄË÷Òý£¬Ã¿ 1 Î»´ú±íÒ»¸öÄ£°æ£¬1 ±íÊ¾¶ÔÓ¦´æ´¢ÇøÓò
 513            µÄÄ£°æÒÑ¾­Â¼Èë£¬0 ±íÊ¾Ã»Â¼Èë¡£
 514            ·µ »Ø Öµ  :   ÎÞ
 515           *************************************************/
 516          void PS_ReadIndexTable(u8 PageID)
 517          {
 518   1        AS608_SendParamPkg(0x01,0x0004,0x1f,&PageID);
 519   1      }
 520          
 521          /************************************************
 522            º¯ÊýÃû³Æ  :   AS608_JudgeData
 523            ¹¦    ÄÜ  :   ´îÅäUARTÊ¹ÓÃ£¬·ÖÎö½ÓÊÕµ½µÄÊý¾Ý£¬ÌáÈ¡ÆäÖÐµÄÈ·ÈÏÂë¼°Êý¾Ý£¨Èç¹û´æÔÚ£©
 524            ²Î    Êý  :   data£º½ÓÊÕµ½µÄÊý¾Ý
 525            ·µ »Ø Öµ  :   ÎÞ
 526           *************************************************/
 527          /*      È·ÈÏÂëµÄº¬Òå£º
 528            {0x00, "       OK       "},
 529            {0x01, " Êý¾Ý°ü½ÓÊÕ´íÎó "},
 530            {0x02, "´«¸ÐÆ÷ÉÏÃ»ÓÐÊÖÖ¸"},
 531            {0x03, "Â¼ÈëÖ¸ÎÆÍ¼ÏñÊ§°Ü"},
 532            {0x04, " Ö¸ÎÆÌ«¸É»òÌ«µ­ "},
 533            {0x05, " Ö¸ÎÆÌ«Êª»òÌ«ºý "},
 534            {0x06, "  Ö¸ÎÆÍ¼ÏñÌ«ÂÒ  "},
 535            {0x07, " Ö¸ÎÆÌØÕ÷µãÌ«ÉÙ "},
 536            {0x08, "  Ö¸ÎÆ²»Æ¥Åä    "},
 537            {0x09, " Ã»ÓÐËÑË÷µ½Ö¸ÎÆ "},
 538            {0x0a, "   ÌØÕ÷ºÏ²¢Ê§°Ü "},
 539            {0x0b, "µØÖ·ÐòºÅ³¬³ö·¶Î§"},
 540            {0x10, "  É¾³ýÄ£°åÊ§°Ü  "},
 541            {0x11, " Çå¿ÕÖ¸ÎÆ¿âÊ§°Ü "},
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 10  

 542            {0x15, "»º³åÇøÄÚÎÞÓÐÐ§Í¼"},
 543            {0x18, " ¶ÁÐ´FLASH³ö´í  "},
 544            {0x19, "   Î´¶¨Òå´íÎó   "},
 545            {0x1a, "  ÎÞÐ§¼Ä´æÆ÷ºÅ  "},
 546            {0x1b, " ¼Ä´æÆ÷ÄÚÈÝ´íÎó "},
 547            {0x1c, " ¼ÇÊÂ±¾Ò³Âë´íÎó "},
 548            {0x1f, "    Ö¸ÎÆ¿âÂú    "},
 549            {0x20, "    µØÖ·´íÎó    "}
 550           */
 551          void AS608_JudgeData(u8 *ucstr)
 552          {
 553   1        u16 AS608_Check_Sum;  //´æ´¢Ó¦´ð°üµÄÐ£ÑéºÍ
 554   1        u16 AS608_Bytes_Sum;  //´æ´¢¼ÆËã³öµÄÐ£ÑéºÍ
 555   1        u16 length;         //´æ´¢°ü³¤¶È
 556   1        u8 result;          //´æ´¢È·ÈÏÂë
 557   1        /* ¼ìÑéÓ¦´ð°ü¸ñÊ½ */
 558   1        if(*ucstr==0xEF && *(ucstr+1)==0x01 && *(ucstr+2)==(u8)(AS608Addr>>24) && *(ucstr+3)==(u8)(AS608Addr>>16)
             - && *(ucstr+4)==(u8)(AS608Addr>>8) && *(ucstr+5)==(u8)(AS608Addr) && *(ucstr+6)==0x07)
 559   1        {
 560   2          
 561   2          /* È·ÈÏÊÇAS608Ó¦´ð°ü£¬¿ªÊ¼¼ìÑéÐ£ÑéºÍ */
 562   2          length = (*(ucstr+7)<<8) + *(ucstr+8);  //»ñÈ¡°ü³¤¶È
 563   2          AS608_Check_Sum = (*(ucstr+7+length)<<8) + *(ucstr+7+length+1);//»ñÈ¡Ð£ÑéºÍ
 564   2          /* ¼ÆËãÐ£ÑéºÍ */
 565   2          AS608_Bytes_Sum = 0x07; //ÏÈ¼ÓÉÏ°ü±êÊ¶
 566   2          while(length--) 
 567   2          {
 568   3            AS608_Bytes_Sum += *(ucstr+7+length); 
 569   3          }
 570   2          /* ±È¶ÔÐ£ÑéºÍ */
 571   2          if(AS608_Bytes_Sum==AS608_Check_Sum)  /* AS608_Bytes_Sum!=0,¼´Ð£ÑéºÍ²»ÕýÈ·£¬¼ìÑéÊ§°Ü */
 572   2          {
 573   3            
 574   3            /* Ð£ÑéºÍ¼ì²â³É¹¦ */
 575   3            /* ·ÖÎöÈ·ÈÏÂë */
 576   3            result = *(ucstr+9);  //»ñÈ¡È·ÈÏÂë
 577   3            if(result==0x00){
 578   4              UART_SendStr("   OK   ");
 579   4            }else{
 580   4              UART_SendStr("  Ê§°Ü  ");
 581   4            }
 582   3            
 583   3            /* ´¦ÀíÊý¾Ý£¬¿ÉÑ¡ */
 584   3            length = (*(ucstr+7)<<8) + *(ucstr+8);  //»ñÈ¡°ü³¤¶È
 585   3            if(length>0x03) //°ü³¤¶È>3£¬´ú±íÓ¦´ð°üÐ¯´øÁË¶îÍâÊý¾Ý
 586   3            {
 587   4              //×ÔÖ÷ÅäÖÃ£¬Ö´ÐÐÏàÓ¦²Ù×÷
 588   4            }
 589   3          }
 590   2          else
 591   2          { 
 592   3            /* FAIL */
 593   3            UART_SendStr("Ð£ÑéºÍÓÐÎó");
 594   3          }
 595   2        }
 596   1        else
 597   1        {   /* ²»·ûºÏÓ¦´ð°ü¸ñÊ½ */
 598   2          /* FAIL */
 599   2          UART_SendStr("Õâ²»ÊÇAS608Ó¦´ð°ü");
 600   2          
 601   2        }
 602   1      }
C51 COMPILER V9.54   AS608                                                                 08/27/2023 04:11:52 PAGE 11  



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1287    ----
   CONSTANT SIZE    =     47    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      85
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
